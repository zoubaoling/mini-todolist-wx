<view class="profile-page">
  <!-- 用户信息头部 -->
  <view class="profile-header">
    <view class="user-info">
      <view class="avatar-container" bind:tap="handleAvatarTap">
        <image 
          class="user-avatar" 
          src="{{userInfo.avatarUrl || '/assets/images/default-avatar.png'}}"
          mode="aspectFill"
          bind:error="handleAvatarError"
          show-menu-by-longpress="{{false}}"
          lazy-load="{{true}}"
        />
        <view class="avatar-edit-icon">📷</view>
      </view>
      <view class="user-details">
        <view class="nickname-container" bind:tap="handleNicknameTap">
          <text class="user-name">{{userInfo.nickName || '未登录'}}</text>
          <view class="edit-icon">✏️</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 数据统计卡片 -->
  <view class="stats-section">
    <view class="stats-grid">
      <view class="stat-card">
        <text class="stat-number">{{userStats.total || 0}}</text>
        <text class="stat-label">总任务数</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{userStats.completed || 0}}</text>
        <text class="stat-label">已完成</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{userStats.continuousDays || 0}}</text>
        <text class="stat-label">连续天数</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{userStats.completionRateStr || '0%'}}</text>
        <text class="stat-label">完成率</text>
      </view>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <view wx:for="{{menuConfig}}" wx:key="title" class="menu-group">
      <view class="menu-group-title">{{item.title}}</view>
      <view wx:for="{{item.items}}" wx:key="text" wx:for-item="menuItem" class="menu-item" bind:tap="{{menuItem.action}}">
        <view class="menu-icon">{{menuItem.icon}}</view>
        <text class="menu-text">{{menuItem.text}}</text>
        <view class="menu-arrow">></view>
      </view>
    </view>
  </view>


  <!-- 退出登录按钮 -->
  <view class="logout-section">
    <button class="logout-btn" bind:tap="handleLogout">
      退出登录
    </button>
  </view>

  <!-- 登录提示弹窗 -->
  <view wx:if="{{showLoginModal}}" class="login-modal-overlay" bind:tap="closeLoginModal">
    <view class="login-modal" catch:tap="stopPropagation">
      <view class="login-modal-title">需要登录</view>
      <view class="login-modal-content">请先登录以查看您的个人数据</view>
      <view class="login-modal-actions">
        <button class="login-modal-btn primary" bind:tap="goToLogin">去登录</button>
        <button class="login-modal-btn secondary" bind:tap="closeLoginModal">取消</button>
      </view>
    </view>
  </view>

  <!-- 昵称编辑弹窗 -->
  <view wx:if="{{showNicknameDialog}}" class="nickname-modal-overlay">
    <view class="nickname-modal">
      <view class="nickname-modal-title">修改昵称</view>
      <view class="nickname-input-container">
        <input
          class="nickname-input"
          value="{{editingNickname}}"
          placeholder="请输入昵称"
          maxlength="20"
          bind:input="handleNicknameInputChange"
          bind:blur="handleNicknameInputChange"
          focus="{{showNicknameDialog}}"
          confirm-type="done"
        />
      </view>
      <view class="nickname-modal-actions">
        <button class="nickname-modal-btn secondary" bind:tap="handleNicknameCancel">取消</button>
        <button class="nickname-modal-btn primary" bind:tap="handleNicknameConfirm">保存</button>
      </view>
    </view>
  </view>

</view>