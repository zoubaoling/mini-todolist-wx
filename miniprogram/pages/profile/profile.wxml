<view class="profile-page">
  <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
  <view class="profile-header">
    <view class="user-info">
      <view class="avatar-container" bind:tap="handleAvatarTap">
        <image 
          class="user-avatar" 
          src="{{userInfo.avatarUrl || '/assets/images/default-avatar.png'}}"
          mode="aspectFill"
          bind:error="handleAvatarError"
          show-menu-by-longpress="{{false}}"
          lazy-load="{{true}}"
        />
        <view class="avatar-edit-icon">ğŸ“·</view>
      </view>
      <view class="user-details">
        <view class="nickname-container" bind:tap="handleNicknameTap">
          <text class="user-name">{{userInfo.nickName || 'æœªç™»å½•'}}</text>
          <view class="edit-icon">âœï¸</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ•°æ®ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-section">
    <view class="stats-grid">
      <view class="stat-card">
        <text class="stat-number">{{userStats.total || 0}}</text>
        <text class="stat-label">æ€»ä»»åŠ¡æ•°</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{userStats.completed || 0}}</text>
        <text class="stat-label">å·²å®Œæˆ</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{userStats.continuousDays || 0}}</text>
        <text class="stat-label">è¿ç»­å¤©æ•°</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{userStats.completionRateStr || '0%'}}</text>
        <text class="stat-label">å®Œæˆç‡</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <view wx:for="{{menuConfig}}" wx:key="title" class="menu-group">
      <view class="menu-group-title">{{item.title}}</view>
      <view wx:for="{{item.items}}" wx:key="text" wx:for-item="menuItem" class="menu-item" bind:tap="{{menuItem.action}}">
        <view class="menu-icon">{{menuItem.icon}}</view>
        <text class="menu-text">{{menuItem.text}}</text>
        <view class="menu-arrow">></view>
      </view>
    </view>
  </view>


  <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
  <view class="logout-section">
    <button class="logout-btn" bind:tap="handleLogout">
      é€€å‡ºç™»å½•
    </button>
  </view>

  <!-- ç™»å½•æç¤ºå¼¹çª— -->
  <view wx:if="{{showLoginModal}}" class="login-modal-overlay" bind:tap="closeLoginModal">
    <view class="login-modal" catch:tap="stopPropagation">
      <view class="login-modal-title">éœ€è¦ç™»å½•</view>
      <view class="login-modal-content">è¯·å…ˆç™»å½•ä»¥æŸ¥çœ‹æ‚¨çš„ä¸ªäººæ•°æ®</view>
      <view class="login-modal-actions">
        <button class="login-modal-btn primary" bind:tap="goToLogin">å»ç™»å½•</button>
        <button class="login-modal-btn secondary" bind:tap="closeLoginModal">å–æ¶ˆ</button>
      </view>
    </view>
  </view>

  <!-- æ˜µç§°ç¼–è¾‘å¼¹çª— -->
  <view wx:if="{{showNicknameDialog}}" class="nickname-modal-overlay">
    <view class="nickname-modal">
      <view class="nickname-modal-title">ä¿®æ”¹æ˜µç§°</view>
      <view class="nickname-input-container">
        <input
          class="nickname-input"
          value="{{editingNickname}}"
          placeholder="è¯·è¾“å…¥æ˜µç§°"
          maxlength="20"
          bind:input="handleNicknameInputChange"
          bind:blur="handleNicknameInputChange"
          focus="{{showNicknameDialog}}"
          confirm-type="done"
        />
      </view>
      <view class="nickname-modal-actions">
        <button class="nickname-modal-btn secondary" bind:tap="handleNicknameCancel">å–æ¶ˆ</button>
        <button class="nickname-modal-btn primary" bind:tap="handleNicknameConfirm">ä¿å­˜</button>
      </view>
    </view>
  </view>

</view>