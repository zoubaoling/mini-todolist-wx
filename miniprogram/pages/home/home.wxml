<view class="home-page">
  <!-- header -->
  <navigator-bar title="智能待办清单" subTitle="让生活更有序"></navigator-bar>
  <view class="home-content">
    <!-- 任务概览 -->
    <view class="task-overview">
      <view wx:for="{{overviewData}}" wx:key="label"
        class="overview-item">
        <text class="overview-item-value">{{item.value}}</text>
        <text class="overview-item-label">{{item.label}}</text>
      </view>
    </view>
    <!-- 任务列表 -->
    <view class="task-content">
      <!-- 过滤器 -->
      <view class="filter-content">
        <!-- 搜索框 -->
        <view class="search-input-container">
          <input
            class="search-input"
            placeholder="搜索任务..."
            placeholder-class="search-input__placeholder"
            model:value="{{searchTaskValue}}"
            bind:confirm="handleSearchTask"
            bind:input="debounceSearchTask"
            confirm-type="search"
          />
          <!-- 清除按钮 -->
          <view 
            wx:if="{{searchTaskValue}}"
            class="search-clear-btn"
            bind:tap="clearSearch"
          >
            <text class="search-clear-icon">×</text>
          </view>
        </view>
        
        <view class="search-tabs">
          <view
            wx:for="{{searchTaskTabs}}"
            wx:key="type"
            bind:tap="handleSearchTabTap"
            data-type="{{item.type}}"
            class="search-tab {{selectedSearchTaskTab === item.type ? 'search-tab-active' : ''}}"
            >
            <text>{{item.label}}</text>
          </view>
        </view>
      </view>
      <!-- 过滤任务列表 -->
      <scroll-view 
        class="task-list"
        scroll-y
        enhanced
        show-scrollbar="{{true}}"
        refresher-enabled="{{true}}"
        bindscroll="handleScroll"
        >
        <!-- 任务列表 -->
        <block wx:for="{{taskList}}" wx:key="_id" wx:if="{{taskList.length > 0}}">
          <t-swipe-cell
            id="{{item._id}}"
            >
            <view
              class="task-item {{item.itemClass}}"
              bind:tap="navigateToTaskDetail"
              data-id="{{item._id}}"
              data-status="{{item.status}}"
              data-is-editable="{{item.isEditable}}"
              >
              <view class="task-header">
                <!-- todo: 任务完成后，划线灰质禁止操作 -->
                <view class="radio-group">
                  <label class="radio-item">
                    <radio 
                      class="radio-item-radio" 
                      color="#667eea"
                      value="{{item.id}}"
                      checked="{{item.status === 'COMPLETED'}}"
                      catch:tap="handleTaskStatusChange"
                      data-id="{{item._id}}"
                      data-status="{{item.status}}"
                      data-is-editable="{{item.isEditable}}"
                    />
                    <text class="radio-item-text {{item.textClass}}">{{item.text}}</text>
                  </label>
                </view>
                <view class="task-priority {{item.priorityClass}} {{item.textClass}}">{{item.priorityLabel}}</view>
              </view>
              <view class="task-meta">
                <!-- 已完成、未完成的时间 -->
                <view class="task-date">
                  <image src="/assets/images/date.png" class="task-date-icon" />
                  <text class="task-date-text {{item.dateClass}}">{{ item.status === 'COMPLETED' ? '已完成' : item.date}}</text>
                </view>
                <view class="task-category {{item.categoryClass}}">{{item.categoryLabel}}</view>
              </view>
            </view>
            <view slot="right" class="right-slot">
              <view wx:if="{{item.isEditable}}" class="btn edit-btn column" data-id="{{item._id}}" bind:tap="onSwipeCellEditClick">
                编辑
              </view>
              <view class="btn delete-btn column" data-id="{{item._id}}" bind:tap="onSwipeCellDeleteClick">
                删除
              </view>
            </view>
          </t-swipe-cell>
        </block>
        <!-- 空状态 -->
        <view wx:if="{{taskList.length === 0}}" class="empty-state">
          <view class="empty-state-icon">
            <text class="empty-icon">📝</text>
          </view>
          <view class="empty-state-title">暂无任务</view>
          <view class="empty-state-desc">
            <text wx:if="{{selectedSearchTaskTab === 'ALL'}}">还没有创建任何任务，快去添加第一个任务吧！</text>
            <text wx:else>当前分类下暂无任务，试试其他分类或创建新任务</text>
          </view>
          <button class="empty-state-btn" bind:tap="navigateToAddTask">
            <text>+ 添加任务</text>
          </button>
        </view>
      </scroll-view>
    </view>
  </view>
  
  <!-- 悬浮按钮：只在有任务时显示 -->
  <button 
    wx:if="{{taskList.length > 0}}" 
    class="floating-add-btn" 
    bindtap="navigateToAddTask"
  >
    <text>+</text>
  </button>
</view>